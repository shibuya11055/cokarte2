<%# filepath: app/views/client_records/edit.html.erb %>
<div class="client-form-container">
  <h1>カルテ編集</h1>
  <div class="client-form-card">
    <%= form_with(model: @client_record, local: true) do |f| %>
      <table class="client-form-table">
        <tr>
          <th>顧客</th>
          <td>
            <select name="client_record[client_id]" id="client-select" class="client-select" required style="width:350px;max-width:100%;min-width:220px;">
              <option value="">選択してください</option>
              <% Client.all.each do |c| %>
                <option value="<%= c.id %>" <%= 'selected' if defined?(@client_record) && c.id == @client_record.client_id %>><%= c.last_name + c.first_name %></option>
              <% end %>
            </select>
          </td>
        </tr>
        <tr><th>来店日時</th><td><%= f.datetime_field :visited_at, required: true %></td></tr>
        <tr><th>金額</th><td><%= f.number_field :amount, min: 0 %></td></tr>
        <tr><th>ノート</th><td><%= f.text_area :note, rows: 3 %></td></tr>
      </table>
      <div class="client-form-actions">
        <%= f.submit '更新する', class: 'btn btn-detail' %>
        <%= link_to '詳細へ戻る', client_record_path(@client_record), class: 'btn' %>
      </div>
    <% end %>
  </div>
</div>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
function activateClientSelect2() {
  if (window.jQuery && $('.client-select').length) {
    // select2の重複初期化防止
    if ($('.client-select').hasClass('select2-hidden-accessible')) {
      $('.client-select').select2('destroy');
    }
    $('.client-select').select2({
      width: '100%',
      placeholder: '選択してください',
      allowClear: true,
      language: {
        noResults: function() { return '該当なし'; }
      }
    });
  }
}
document.addEventListener('DOMContentLoaded', activateClientSelect2);
document.addEventListener('turbo:load', activateClientSelect2);
document.addEventListener('turbo:frame-load', activateClientSelect2);
</script>
