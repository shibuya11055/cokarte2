<div class="client-list-header">
  <h1>顧客一覧</h1>
</div>
<form method="get" action="<%= clients_path %>" class="client-search-form">
  <div class="client-search-main">
    <input type="text" name="q" value="<%= params[:q] %>" placeholder="氏名・フリガナで検索">
    <button type="submit" class="btn btn-detail">検索</button>
    <% if params[:q].present? %>
      <%= link_to 'クリア', clients_path, class: 'btn' %>
    <% end %>
  </div>
  <div class="client-search-side">
    <%= link_to '新規顧客登録', new_client_path, class: 'btn btn-detail' %>
  </div>
</form>
<table class="client-table">
  <thead>
    <tr>
      <th>氏名</th>
      <th>最近のカルテ</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <% @clients.each do |client| %>
      <tr>
        <td>
          <div><%= client.last_name + client.first_name %></div>
          <% if client.last_name_kana.present? || client.first_name_kana.present? %>
            <div style="color:#777; font-size: 0.9em;">
              (<%= [client.last_name_kana, client.first_name_kana].compact.join %>)
            </div>
          <% end %>
        </td>
        <td>
          <% record = @latest_records[client.id] %>
          <% if record %>
            <%= link_to(record.visited_at&.strftime('%Y/%m/%d %H:%M'), client_record_path(record), style: 'font-size:0.92em; color:#218a5a; text-decoration:underline;') %>
          <% else %>
            <span style="color:#bbb;">-</span>
          <% end %>
        </td>
        <td>
          <%= link_to '詳細', client_path(client), class: 'btn btn-detail' %>
          <%= button_to '削除', client_path(client), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<div class="pagination">
  <%= paginate @clients %>
</div>
