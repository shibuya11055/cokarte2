<div class="client-list-header" style="display: flex; align-items: flex-end; justify-content: space-between; margin-bottom: 1.2rem;">
  <h1>顧客一覧</h1>
</div>
<form method="get" action="<%= clients_path %>" class="client-search-form" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center;">
  <div style="display: flex; gap: 1rem; align-items: center; flex: 1 1 auto;">
    <input type="text" name="q" value="<%= params[:q] %>" placeholder="氏名で検索" style="padding: 0.6rem 1rem; border-radius: 6px; border: 1px solid #b2dfdb; min-width: 220px; font-size: 1rem;">
    <button type="submit" class="btn btn-detail">検索</button>
    <% if params[:q].present? %>
      <%= link_to 'クリア', clients_path, class: 'btn' %>
    <% end %>
  </div>
  <div style="flex: 0 0 auto; margin-left: auto;">
    <%= link_to '新規顧客登録', new_client_path, class: 'btn btn-detail' %>
  </div>
</form>
<table class="client-table">
  <thead>
    <tr>
      <th>氏名</th>
      <th>最近のカルテ</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <% @clients.each do |client| %>
      <tr>
        <td><%= client.last_name + client.first_name %></td>
        <td>
          <% record = @latest_records[client.id] %>
          <% if record %>
            <%= link_to(record.visited_at&.strftime('%Y/%m/%d %H:%M'), client_record_path(record), style: 'font-size:0.92em; color:#218a5a; text-decoration:underline;') %>
          <% else %>
            <span style="color:#bbb;">-</span>
          <% end %>
        </td>
        <td>
          <%= link_to '詳細', client_path(client), class: 'btn btn-detail' %>
          <%= button_to '削除', client_path(client), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<div class="pagination">
  <%= paginate @clients %>
</div>
