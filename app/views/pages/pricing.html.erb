<div class="pricing-container">
  <h1>料金プラン</h1>
  <div class="pricing-grid">
    <% current = current_user&.plan_tier %>

    <div class="plan-card">
      <div class="plan-header">
        <h2>Free</h2>
        <div class="price">¥0<span>/月</span></div>
      </div>
      <ul class="features">
        <li>顧客 50 名まで</li>
        <li>1カルテにつき画像を1枚まで登録可能</li>
      </ul>
      <div class="plan-actions">
        <% if current == 'free' %>
          <button class="btn" disabled>現在のプラン</button>
        <% else %>
          <%= link_to 'このプランを利用', pricing_path, class: 'btn' %>
        <% end %>
      </div>
    </div>

    <div class="plan-card featured">
      <div class="plan-header">
        <h2>Basic</h2>
        <div class="price">¥500<span>/月</span></div>
      </div>
      <ul class="features">
        <li>顧客 150 名まで</li>
        <li>1カルテにつき画像を3枚まで登録可能</li>
      </ul>
      <div class="plan-actions">
        <% if current == 'basic' %>
          <button class="btn btn-detail" disabled>現在のプラン</button>
        <% else %>
          <%= button_to 'Basic にアップグレード', billing_checkout_path(plan: 'basic'), method: :post, class: 'btn btn-detail', data: { turbo: false } %>
        <% end %>
      </div>
    </div>

    <div class="plan-card">
      <div class="badge">おすすめ</div>
      <div class="plan-header">
        <h2>Pro</h2>
        <div class="price">¥1,000<span>/月</span></div>
      </div>
      <ul class="features">
        <li>顧客 無制限</li>
        <li>1カルテにつき画像を3枚まで登録可能</li>
      </ul>
      <div class="plan-actions">
        <% if current == 'pro' %>
          <button class="btn btn-detail" disabled>現在のプラン</button>
        <% else %>
          <%= button_to 'Pro にアップグレード', billing_checkout_path(plan: 'pro'), method: :post, class: 'btn btn-detail', data: { turbo: false } %>
        <% end %>
      </div>
    </div>
  </div>

  <% if current_user&.stripe_customer_id.present? %>
    <div class="pricing-portal">
      <%= button_to '請求履歴・領収書のダウンロード（Customer Portal）', billing_portal_path, method: :post, class: 'btn', data: { turbo: false } %>
      <div style="font-size:0.9rem; color:#6c8f7f; margin-top:0.3rem;">※ ポータルから請求履歴・領収書（PDF）のダウンロード、支払い方法の変更・解約ができます。</div>
    </div>
  <% end %>
</div>
